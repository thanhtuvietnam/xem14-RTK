var j=u=>{throw TypeError(u)};var q=(u,d,t)=>d.has(u)||j("Cannot "+t);var e=(u,d,t)=>(q(u,d,"read from private field"),t?t.call(u):d.get(u)),f=(u,d,t)=>d.has(u)?j("Cannot add the same private member more than once"):d instanceof WeakSet?d.add(u):d.set(u,t),r=(u,d,t,i)=>(q(u,d,"write to private field"),i?i.call(u,t):d.set(u,t),t),o=(u,d,t)=>(q(u,d,"access private method"),t);import{m as ut,n as B,o as $,R as lt,p as dt,e as A,c as M,b as ft,q as N,L as R,l as pt,r as yt,T as bt,Q as U}from"./index-xleVCo4H.js";import{E as vt}from"./vidstack-CJK75N1i-CQEs4XXL.js";import{resolveVimeoVideoId as kt,getVimeoVideoInfo as mt}from"./vidstack-krOAtKMi-C3UUF7YD.js";const wt=["bufferend","bufferstart","durationchange","ended","enterpictureinpicture","error","fullscreenchange","leavepictureinpicture","loaded","playProgress","loadProgress","pause","play","playbackratechange","qualitychange","seeked","seeking","timeupdate","volumechange","waiting"];var a,p,b,m,T,V,v,C,I,w,k,g,s,_,W,Y,z,P,G,H,J,S,K,X,Z,tt,et,Q,st,it,nt,L,at,x,ot,D,ht,rt,c,F,O;class $t extends vt{constructor(t,i){super(t);f(this,s);f(this,a);f(this,p);f(this,b);f(this,m);f(this,T);f(this,V);f(this,v);f(this,C);f(this,I);f(this,w);f(this,k);f(this,g);f(this,P);this.$$PROVIDER_TYPE="VIMEO",this.scope=ut(),r(this,p,B("")),r(this,b,B(!1)),r(this,m,null),r(this,T,null),r(this,V,!1),r(this,v,new $(0,0)),r(this,C,new lt(o(this,s,z).bind(this))),r(this,I,null),r(this,w,null),r(this,k,new Map),r(this,g,null),this.cookies=!1,this.title=!0,this.byline=!0,this.portrait=!0,this.color="00ADEF",r(this,P,!1),r(this,a,i);const n=this;this.fullscreen={get active(){return e(n,V)},supported:!0,enter:()=>o(this,s,c).call(this,"requestFullscreen"),exit:()=>o(this,s,c).call(this,"exitFullscreen")}}get type(){return"vimeo"}get currentSrc(){return e(this,T)}get videoId(){return e(this,p).call(this)}get hash(){return e(this,m)}get isPro(){return e(this,b).call(this)}preconnect(){dt(this.getOrigin())}setup(){super.setup(),A(o(this,s,_).bind(this)),A(o(this,s,W).bind(this)),A(o(this,s,Y).bind(this)),e(this,a).notify("provider-setup",this)}destroy(){o(this,s,F).call(this),this.fullscreen=void 0;const t="provider destroyed";for(const i of e(this,k).values())for(const{reject:n}of i)n(t);e(this,k).clear(),o(this,s,c).call(this,"destroy")}async play(){return o(this,s,c).call(this,"play")}async pause(){return o(this,s,c).call(this,"pause")}setMuted(t){o(this,s,c).call(this,"setMuted",t)}setCurrentTime(t){o(this,s,c).call(this,"seekTo",t),e(this,a).notify("seeking",t)}setVolume(t){o(this,s,c).call(this,"setVolume",t),o(this,s,c).call(this,"setMuted",M(e(this,a).$state.muted))}setPlaybackRate(t){o(this,s,c).call(this,"setPlaybackRate",t)}async loadSource(t){if(!ft(t.src)){r(this,T,null),r(this,m,null),e(this,p).set("");return}const{videoId:i,hash:n}=kt(t.src);e(this,p).set(i??""),r(this,m,n??null),r(this,T,t)}getOrigin(){return"https://player.vimeo.com"}buildParams(){const{keyDisabled:t}=e(this,a).$props,{playsInline:i,nativeControls:n}=e(this,a).$state,h=n();return{title:this.title,byline:this.byline,color:this.color,portrait:this.portrait,controls:h,h:this.hash,keyboard:h&&!t(),transparent:!0,playsinline:i(),dnt:!this.cookies}}onMessage(t,i){t.event?o(this,s,ht).call(this,t.event,t.data,i):t.method&&o(this,s,K).call(this,t.method,t.value,i)}onLoad(){}}a=new WeakMap,p=new WeakMap,b=new WeakMap,m=new WeakMap,T=new WeakMap,V=new WeakMap,v=new WeakMap,C=new WeakMap,I=new WeakMap,w=new WeakMap,k=new WeakMap,g=new WeakMap,s=new WeakSet,_=function(){o(this,s,F).call(this);const t=e(this,p).call(this);if(!t){this.src.set("");return}this.src.set(`${this.getOrigin()}/video/${t}`),e(this,a).notify("load-start")},W=function(){const t=e(this,p).call(this);if(!t)return;const i=N(),n=new AbortController;return r(this,g,i),mt(t,n,e(this,m)).then(h=>{i.resolve(h)}).catch(h=>{i.reject()}),()=>{i.reject(),n.abort()}},Y=function(){const t=e(this,b).call(this),{$state:i,qualities:n}=e(this,a);if(i.canSetPlaybackRate.set(t),n[R.setReadonly](!t),t)return pt(n,"change",()=>{var l;if(n.auto)return;const h=(l=n.selected)==null?void 0:l.id;h&&o(this,s,c).call(this,"setQuality",h)})},z=function(){o(this,s,c).call(this,"getCurrentTime")},P=new WeakMap,G=function(t,i){if(e(this,P)&&t===0)return;const{realCurrentTime:n,realDuration:h,paused:l,bufferedEnd:y}=e(this,a).$state;if(n()===t)return;const E=n();e(this,a).notify("time-change",t,i),Math.abs(E-t)>1.5&&(e(this,a).notify("seeking",t,i),!l()&&y()<t&&e(this,a).notify("waiting",void 0,i)),h()-t<.01&&(e(this,a).notify("end",void 0,i),r(this,P,!0),setTimeout(()=>{r(this,P,!1)},500))},H=function(t,i){e(this,a).notify("seeked",t,i)},J=function(t){var n;const i=e(this,p).call(this);(n=e(this,g))==null||n.promise.then(h=>{if(!h)return;const{title:l,poster:y,duration:E,pro:ct}=h;e(this,b).set(ct),e(this,a).notify("title-change",l,t),e(this,a).notify("poster-change",y,t),e(this,a).notify("duration-change",E,t),o(this,s,S).call(this,E,t)}).catch(()=>{i===e(this,p).call(this)&&(o(this,s,c).call(this,"getVideoTitle"),o(this,s,c).call(this,"getDuration"))})},S=function(t,i){const{nativeControls:n}=e(this,a).$state,h=n();r(this,v,new $(0,t));const l={buffered:new $(0,0),seekable:e(this,v),duration:t};e(this,a).delegate.ready(l,i),h||o(this,s,c).call(this,"_hideOverlay"),o(this,s,c).call(this,"getQualities"),o(this,s,c).call(this,"getChapters")},K=function(t,i,n){var h;switch(t){case"getVideoTitle":const l=i;e(this,a).notify("title-change",l,n);break;case"getDuration":const y=i;e(this,a).$state.canPlay()?e(this,a).notify("duration-change",y,n):o(this,s,S).call(this,y,n);break;case"getCurrentTime":o(this,s,G).call(this,i,n);break;case"getBuffered":yt(i)&&i.length&&o(this,s,Q).call(this,i[i.length-1][1],n);break;case"setMuted":o(this,s,L).call(this,M(e(this,a).$state.volume),i,n);break;case"getChapters":o(this,s,at).call(this,i);break;case"getQualities":o(this,s,ot).call(this,i,n);break}(h=o(this,s,O).call(this,t))==null||h.resolve()},X=function(){for(const t of wt)o(this,s,c).call(this,"addEventListener",t)},Z=function(t){e(this,C).stop(),e(this,a).notify("pause",void 0,t)},tt=function(t){e(this,C).start(),e(this,a).notify("play",void 0,t)},et=function(t){const{paused:i}=e(this,a).$state;!i()&&!e(this,P)&&e(this,a).notify("playing",void 0,t)},Q=function(t,i){const n={buffered:new $(0,t),seekable:e(this,v)};e(this,a).notify("progress",n,i)},st=function(t){e(this,a).notify("waiting",void 0,t)},it=function(t){const{paused:i}=e(this,a).$state;i()||e(this,a).notify("playing",void 0,t)},nt=function(t){const{paused:i}=e(this,a).$state;i()&&e(this,a).notify("play",void 0,t),e(this,a).notify("waiting",void 0,t)},L=function(t,i,n){const h={volume:t,muted:i};e(this,a).notify("volume-change",h,n)},at=function(t){if(o(this,s,x).call(this),!t.length)return;const i=new bt({kind:"chapters",default:!0}),{realDuration:n}=e(this,a).$state;for(let h=0;h<t.length;h++){const l=t[h],y=t[h+1];i.addCue(new window.VTTCue(l.startTime,(y==null?void 0:y.startTime)??n(),l.title))}r(this,w,i),e(this,a).textTracks.add(i)},x=function(){e(this,w)&&(e(this,a).textTracks.remove(e(this,w)),r(this,w,null))},ot=function(t,i){e(this,a).qualities[U.enableAuto]=t.some(n=>n.id==="auto")?()=>o(this,s,c).call(this,"setQuality","auto"):void 0;for(const n of t){if(n.id==="auto")continue;const h=+n.id.slice(0,-1);isNaN(h)||e(this,a).qualities[R.add]({id:n.id,width:h*(16/9),height:h,codec:"avc1,h.264",bitrate:-1},i)}o(this,s,D).call(this,t.find(n=>n.active),i)},D=function({id:t}={},i){if(!t)return;const n=t==="auto",h=e(this,a).qualities.getById(t);n?(e(this,a).qualities[U.setAuto](n,i),e(this,a).qualities[R.select](void 0,!0,i)):e(this,a).qualities[R.select](h??void 0,!0,i)},ht=function(t,i,n){switch(t){case"ready":o(this,s,X).call(this);break;case"loaded":o(this,s,J).call(this,n);break;case"play":o(this,s,tt).call(this,n);break;case"playProgress":o(this,s,et).call(this,n);break;case"pause":o(this,s,Z).call(this,n);break;case"loadProgress":o(this,s,Q).call(this,i.seconds,n);break;case"waiting":o(this,s,nt).call(this,n);break;case"bufferstart":o(this,s,st).call(this,n);break;case"bufferend":o(this,s,it).call(this,n);break;case"volumechange":o(this,s,L).call(this,i.volume,M(e(this,a).$state.muted),n);break;case"durationchange":r(this,v,new $(0,i.duration)),e(this,a).notify("duration-change",i.duration,n);break;case"playbackratechange":e(this,a).notify("rate-change",i.playbackRate,n);break;case"qualitychange":o(this,s,D).call(this,i,n);break;case"fullscreenchange":r(this,V,i.fullscreen),e(this,a).notify("fullscreen-change",i.fullscreen,n);break;case"enterpictureinpicture":e(this,a).notify("picture-in-picture-change",!0,n);break;case"leavepictureinpicture":e(this,a).notify("picture-in-picture-change",!1,n);break;case"ended":e(this,a).notify("end",void 0,n);break;case"error":o(this,s,rt).call(this,i,n);break;case"seek":case"seeked":o(this,s,H).call(this,i.seconds,n);break}},rt=function(t,i){var l;const{message:n,method:h}=t;h==="setPlaybackRate"&&e(this,b).set(!1),h&&((l=o(this,s,O).call(this,h))==null||l.reject(n))},c=async function(t,i){let n=N(),h=e(this,k).get(t);return h||e(this,k).set(t,h=[]),h.push(n),this.postMessage({method:t,value:i}),n.promise},F=function(){e(this,C).stop(),r(this,v,new $(0,0)),r(this,g,null),r(this,I,null),e(this,b).set(!1),o(this,s,x).call(this)},O=function(t){var i;return(i=e(this,k).get(t))==null?void 0:i.shift()};export{$t as VimeoProvider};
